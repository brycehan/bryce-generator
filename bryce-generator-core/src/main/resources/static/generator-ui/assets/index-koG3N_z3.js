import{d as N,r as U,a as L,b as r,o as T,c as x,w as t,e as l,f,m as Q,E as C,q as M,s as O,t as P,v as D,i as R,y as E,x as I}from"./index-Dqq0dEST.js";import{g as j,s as K,p as A,a as G,d as H}from"./datasource-CJCjSzJ2.js";import"./request-a1Er5x_U.js";const J=N({__name:"add-or-edit",emits:["refreshPage"],setup(F,{expose:a,emit:y}){const m=y,_=U(!1),b=U(),o=L({id:"",dbType:"",connName:"",connUrl:"",username:"",password:""}),S=L({dbType:[{required:!0,message:"必填项不能为空",trigger:"blur"}],connName:[{required:!0,message:"必填项不能为空",trigger:"blur"}],connUrl:[{required:!0,message:"必填项不能为空",trigger:"blur"}],username:[{required:!0,message:"必填项不能为空",trigger:"blur"}],password:[{required:!0,message:"必填项不能为空",trigger:"blur"}]}),w=n=>{_.value=!0,o.id="",b.value&&b.value.resetFields(),n&&k(n)},k=n=>{j(n).then(e=>{Object.assign(o,e.data)})},V=()=>{b.value.validate(n=>{if(!n)return!1;K(o).then(()=>{_.value=!1,m("refreshPage"),C.success("操作成功")})})};return a({init:w}),(n,e)=>{const p=r("el-input"),i=r("el-form-item"),d=r("el-option"),v=r("el-select"),g=r("el-form"),h=r("el-button"),c=r("el-dialog");return T(),x(c,{modelValue:_.value,"onUpdate:modelValue":e[8]||(e[8]=s=>_.value=s),title:o.id?"修改":"新增","close-on-click-modal":!1},{footer:t(()=>[l(h,{onClick:e[6]||(e[6]=s=>_.value=!1)},{default:t(()=>[f("取消")]),_:1}),l(h,{type:"primary",onClick:e[7]||(e[7]=s=>V())},{default:t(()=>[f("确定")]),_:1})]),default:t(()=>[l(g,{ref_key:"dataFormRef",ref:b,model:o,rules:S,"label-width":"120px",onKeyup:e[5]||(e[5]=Q(s=>V(),["enter"]))},{default:t(()=>[l(i,{label:"连接名",prop:"connName"},{default:t(()=>[l(p,{modelValue:o.connName,"onUpdate:modelValue":e[0]||(e[0]=s=>o.connName=s),placeholder:"连接名"},null,8,["modelValue"])]),_:1}),l(i,{label:"数据库类型",prop:"dbType"},{default:t(()=>[l(v,{modelValue:o.dbType,"onUpdate:modelValue":e[1]||(e[1]=s=>o.dbType=s),placeholder:"数据库类型",clearable:"",style:{width:"100%"}},{default:t(()=>[l(d,{value:"MySQL",label:"MySQL"}),l(d,{value:"PostgreSQL",label:"PostgreSQL"}),l(d,{value:"Oracle",label:"Oracle"}),l(d,{value:"SQLServer",label:"SQLServer"}),l(d,{value:"DM",label:"达梦8"}),l(d,{value:"Clickhouse",label:"Clickhouse"})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"数据库URL",prop:"connUrl"},{default:t(()=>[l(p,{modelValue:o.connUrl,"onUpdate:modelValue":e[2]||(e[2]=s=>o.connUrl=s),placeholder:"数据库URL"},null,8,["modelValue"])]),_:1}),l(i,{label:"用户名",prop:"username"},{default:t(()=>[l(p,{modelValue:o.username,"onUpdate:modelValue":e[3]||(e[3]=s=>o.username=s),placeholder:"用户名"},null,8,["modelValue"])]),_:1}),l(i,{label:"密码",prop:"password"},{default:t(()=>[l(p,{modelValue:o.password,"onUpdate:modelValue":e[4]||(e[4]=s=>o.password=s),type:"password",placeholder:"密码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Z=N({__name:"index",setup(F){const a=L({queryForm:{connName:"",dbType:""},page:{current:1,pageSize:10,total:0,orderItems:[{column:"createTime",asc:!1}]},data:[],dataSelections:[],loading:!1}),y=U();M(()=>{m()});const m=(n=1,e)=>{a.page.current=n,e!==void 0&&(a.page.pageSize=e),a.loading=!0;const p={current:a.page.current,pageSize:a.page.pageSize,orderItems:a.page.orderItems,...a.queryForm};A(p).then(i=>{const{list:d,total:v}=i.data;a.data=d,a.page.total=v}),a.loading=!1},_=n=>{m(1,n)},b=n=>{m(n)},o=n=>{G(n).then(e=>{C.success(e.data)})},S=n=>{y.value.init(n)},w=n=>{let e=[];if(n)e=[n];else if(e=a.dataSelections?a.dataSelections:[],e.length===0){C.warning("请选择删除的记录");return}I.confirm("确定进行删除操作？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{H(e).then(()=>{C.success("删除成功"),m()})}).catch(p=>{console.error(p)})},k=n=>{a.dataSelections=n.map(e=>e.id)},V=n=>Array(n.length).fill("•").join("");return(n,e)=>{const p=r("el-input"),i=r("el-form-item"),d=r("el-option"),v=r("el-select"),g=r("el-button"),h=r("el-form"),c=r("el-table-column"),s=r("el-table"),$=r("el-pagination"),z=r("el-card"),B=O("loading");return T(),x(z,{shadow:"hover"},{default:t(()=>[l(h,{inline:!0,model:a.queryForm,onKeyup:e[5]||(e[5]=Q(u=>m(),["enter"])),onSubmit:e[6]||(e[6]=P(()=>{},["prevent"]))},{default:t(()=>[l(i,null,{default:t(()=>[l(p,{modelValue:a.queryForm.connName,"onUpdate:modelValue":e[0]||(e[0]=u=>a.queryForm.connName=u),placeholder:"连接名"},null,8,["modelValue"])]),_:1}),l(i,{prop:"dbType"},{default:t(()=>[l(v,{modelValue:a.queryForm.dbType,"onUpdate:modelValue":e[1]||(e[1]=u=>a.queryForm.dbType=u),placeholder:"数据库类型",clearable:""},{default:t(()=>[l(d,{value:"MySQL",label:"MySQL"}),l(d,{value:"PostgreSQL",label:"PostgreSQL"}),l(d,{value:"Oracle",label:"Oracle"}),l(d,{value:"SQLServer",label:"SQLServer"}),l(d,{value:"DM",label:"达梦8"})]),_:1},8,["modelValue"])]),_:1}),l(i,null,{default:t(()=>[l(g,{onClick:e[2]||(e[2]=u=>m())},{default:t(()=>[f("查询")]),_:1}),l(g,{type:"primary",onClick:e[3]||(e[3]=u=>S())},{default:t(()=>[f("新增")]),_:1}),l(g,{type:"danger",onClick:e[4]||(e[4]=u=>w())},{default:t(()=>[f("删除")]),_:1})]),_:1})]),_:1},8,["model"]),D((T(),x(s,{data:a.data,border:!0,style:{width:"100%"},onSelectionChange:k},{default:t(()=>[l(c,{type:"selection","header-align":"center",align:"center",width:"50"}),l(c,{label:"连接名",prop:"connName","header-align":"center",align:"center"}),l(c,{label:"数据库类型",prop:"dbType","header-align":"center",align:"center"}),l(c,{label:"数据库URL",prop:"connUrl","show-overflow-tooltip":"","header-align":"center",align:"center"}),l(c,{label:"用户名",prop:"username","header-align":"center",align:"center"}),l(c,{label:"密码","header-align":"center",align:"center"},{default:t(u=>[R("span",null,E(V(u.row.password)),1)]),_:1}),l(c,{label:"操作",fixed:"right","header-align":"center",align:"center",width:"170"},{default:t(u=>[l(g,{type:"success",link:"",onClick:q=>o(u.row.id)},{default:t(()=>[f("测试")]),_:2},1032,["onClick"]),l(g,{type:"primary",link:"",onClick:q=>S(u.row.id)},{default:t(()=>[f("编辑")]),_:2},1032,["onClick"]),l(g,{type:"danger",link:"",onClick:q=>w(u.row.id)},{default:t(()=>[f("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[B,a.loading]]),l($,{"current-page":a.page.current,"page-size":a.page.pageSize,"page-sizes":[10,20,50,100,200],total:a.page.total,layout:"total,sizes,prev,pager,next,jumper",onSizeChange:_,onCurrentChange:b},null,8,["current-page","page-size","total"]),l(J,{ref_key:"addOrEditRef",ref:y,onRefreshPage:m},null,512)]),_:1})}}});export{Z as default};
