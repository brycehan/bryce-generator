import{d as Q,r as L,a as T,b as r,c as x,o as q,w as t,e as l,m as h,i as f,E as k,q as M,s as O,t as P,v as D,f as R,y as E,x as I}from"./index-CuHfYZIc.js";import{g as j,s as K,p as A,a as G,d as H}from"./datasource-CuaPpjN1.js";import"./request-ChiGirky.js";const J=Q({__name:"add-or-edit",emits:["refreshPage"],setup(F,{expose:a,emit:v}){const m=v,b=L(!1),_=L(),o=T({id:"",dbType:"",connName:"",connUrl:"",username:"",password:""}),S=T({dbType:[{required:!0,message:"必填项不能为空",trigger:"blur"}],connName:[{required:!0,message:"必填项不能为空",trigger:"blur"}],connUrl:[{required:!0,message:"必填项不能为空",trigger:"blur"}],username:[{required:!0,message:"必填项不能为空",trigger:"blur"}],password:[{required:!0,message:"必填项不能为空",trigger:"blur"}]}),w=n=>{b.value=!0,o.id="",_.value&&_.value.resetFields(),n&&U(n)},U=n=>{j(n).then(e=>{Object.assign(o,e.data)})},V=()=>{_.value.validate(n=>{if(!n)return!1;K(o).then(()=>{b.value=!1,m("refreshPage"),k.success("操作成功")})})};return a({init:w}),(n,e)=>{const p=r("el-input"),u=r("el-form-item"),d=r("el-option"),y=r("el-select"),c=r("el-form"),C=r("el-button"),g=r("el-dialog");return q(),x(g,{modelValue:b.value,"onUpdate:modelValue":e[8]||(e[8]=s=>b.value=s),title:o.id?"修改":"新增","close-on-click-modal":!1},{footer:t(()=>[l(C,{onClick:e[6]||(e[6]=s=>b.value=!1)},{default:t(()=>e[9]||(e[9]=[f("取消")])),_:1}),l(C,{type:"primary",onClick:e[7]||(e[7]=s=>V())},{default:t(()=>e[10]||(e[10]=[f("确定")])),_:1})]),default:t(()=>[l(c,{ref_key:"dataFormRef",ref:_,model:o,rules:S,"label-width":"120",onKeyup:e[5]||(e[5]=h(s=>V(),["enter"]))},{default:t(()=>[l(u,{label:"连接名",prop:"connName"},{default:t(()=>[l(p,{modelValue:o.connName,"onUpdate:modelValue":e[0]||(e[0]=s=>o.connName=s),placeholder:"连接名"},null,8,["modelValue"])]),_:1}),l(u,{label:"数据库类型",prop:"dbType"},{default:t(()=>[l(y,{modelValue:o.dbType,"onUpdate:modelValue":e[1]||(e[1]=s=>o.dbType=s),placeholder:"数据库类型",clearable:"",style:{width:"100%"}},{default:t(()=>[l(d,{value:"MySQL",label:"MySQL"}),l(d,{value:"PostgreSQL",label:"PostgreSQL"}),l(d,{value:"Oracle",label:"Oracle"}),l(d,{value:"SQLServer",label:"SQLServer"}),l(d,{value:"DM",label:"达梦8"}),l(d,{value:"Clickhouse",label:"Clickhouse"})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"数据库URL",prop:"connUrl"},{default:t(()=>[l(p,{modelValue:o.connUrl,"onUpdate:modelValue":e[2]||(e[2]=s=>o.connUrl=s),placeholder:"数据库URL"},null,8,["modelValue"])]),_:1}),l(u,{label:"用户名",prop:"username"},{default:t(()=>[l(p,{modelValue:o.username,"onUpdate:modelValue":e[3]||(e[3]=s=>o.username=s),placeholder:"用户名"},null,8,["modelValue"])]),_:1}),l(u,{label:"密码",prop:"password"},{default:t(()=>[l(p,{modelValue:o.password,"onUpdate:modelValue":e[4]||(e[4]=s=>o.password=s),type:"password",placeholder:"密码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Z=Q({__name:"index",setup(F){const a=T({queryForm:{connName:"",dbType:""},page:{current:1,pageSize:10,total:0,orderItems:[{column:"createTime",asc:!1}]},data:[],dataSelections:[],loading:!1}),v=L();M(()=>{m()});const m=(n=1,e)=>{a.page.current=n,e!==void 0&&(a.page.pageSize=e),a.loading=!0;const p={current:a.page.current,pageSize:a.page.pageSize,orderItems:a.page.orderItems,...a.queryForm};A(p).then(u=>{const{list:d,total:y}=u.data;a.data=d,a.page.total=y}),a.loading=!1},b=n=>{m(1,n)},_=n=>{m(n)},o=n=>{G(n).then(e=>{k.success(e.data)})},S=n=>{v.value.init(n)},w=n=>{let e=[];if(n)e=[n];else if(e=a.dataSelections?a.dataSelections:[],e.length===0){k.warning("请选择删除的记录");return}I.confirm("确定进行删除操作？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{H(e).then(()=>{k.success("删除成功"),m()})}).catch(p=>{console.error(p)})},U=n=>{a.dataSelections=n.map(e=>e.id)},V=n=>Array(n.length).fill("•").join("");return(n,e)=>{const p=r("el-input"),u=r("el-form-item"),d=r("el-option"),y=r("el-select"),c=r("el-button"),C=r("el-form"),g=r("el-table-column"),s=r("el-table"),$=r("el-pagination"),z=r("el-card"),B=O("loading");return q(),x(z,{shadow:"hover"},{default:t(()=>[l(C,{inline:!0,model:a.queryForm,onKeyup:e[5]||(e[5]=h(i=>m(),["enter"])),onSubmit:e[6]||(e[6]=D(()=>{},["prevent"]))},{default:t(()=>[l(u,null,{default:t(()=>[l(p,{modelValue:a.queryForm.connName,"onUpdate:modelValue":e[0]||(e[0]=i=>a.queryForm.connName=i),placeholder:"连接名",clearable:""},null,8,["modelValue"])]),_:1}),l(u,{prop:"dbType",style:{width:"200px"}},{default:t(()=>[l(y,{modelValue:a.queryForm.dbType,"onUpdate:modelValue":e[1]||(e[1]=i=>a.queryForm.dbType=i),placeholder:"数据库类型",clearable:"",style:{width:"100%"}},{default:t(()=>[l(d,{value:"MySQL",label:"MySQL"}),l(d,{value:"PostgreSQL",label:"PostgreSQL"}),l(d,{value:"Oracle",label:"Oracle"}),l(d,{value:"SQLServer",label:"SQLServer"}),l(d,{value:"DM",label:"达梦8"})]),_:1},8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(c,{onClick:e[2]||(e[2]=i=>m())},{default:t(()=>e[7]||(e[7]=[f("查询")])),_:1}),l(c,{type:"primary",onClick:e[3]||(e[3]=i=>S())},{default:t(()=>e[8]||(e[8]=[f("新增")])),_:1}),l(c,{type:"danger",onClick:e[4]||(e[4]=i=>w())},{default:t(()=>e[9]||(e[9]=[f("删除")])),_:1})]),_:1})]),_:1},8,["model"]),P((q(),x(s,{data:a.data,border:!0,style:{width:"100%"},onSelectionChange:U},{default:t(()=>[l(g,{type:"selection","header-align":"center",align:"center",width:"50"}),l(g,{label:"连接名",prop:"connName","header-align":"center",align:"center"}),l(g,{label:"数据库类型",prop:"dbType","header-align":"center",align:"center"}),l(g,{label:"数据库URL",prop:"connUrl","show-overflow-tooltip":"","header-align":"center",align:"center"}),l(g,{label:"用户名",prop:"username","header-align":"center",align:"center"}),l(g,{label:"密码","header-align":"center",align:"center"},{default:t(i=>[R("span",null,E(V(i.row.password)),1)]),_:1}),l(g,{label:"操作",fixed:"right","header-align":"center",align:"center",width:"170"},{default:t(i=>[l(c,{type:"success",link:"",onClick:N=>o(i.row.id)},{default:t(()=>e[10]||(e[10]=[f("测试")])),_:2},1032,["onClick"]),l(c,{type:"primary",link:"",onClick:N=>S(i.row.id)},{default:t(()=>e[11]||(e[11]=[f("编辑")])),_:2},1032,["onClick"]),l(c,{type:"danger",link:"",onClick:N=>w(i.row.id)},{default:t(()=>e[12]||(e[12]=[f("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[B,a.loading]]),l($,{"current-page":a.page.current,"page-size":a.page.pageSize,"page-sizes":[10,20,50,100,200],total:a.page.total,layout:"total,sizes,prev,pager,next,jumper",onSizeChange:b,onCurrentChange:_},null,8,["current-page","page-size","total"]),l(J,{ref_key:"addOrEditRef",ref:v,onRefreshPage:m},null,512)]),_:1})}}});export{Z as default};
