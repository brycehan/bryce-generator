import{d as q,r as k,a as U,b as s,o as L,c as T,w as a,e,f,m as N,E as V,q as M,s as O,t as P,v as D,i as R,y as E,x as I}from"./index-c2c98dd5.js";import{g as j,s as K,p as A,a as G,d as H}from"./datasource-6d290422.js";import"./request-e59313c2.js";const J=q({__name:"add-or-edit",emits:["refreshPage"],setup(Q,{expose:n,emit:v}){const d=k(!1),_=k(),r=U({id:"",dbType:"",connName:"",connUrl:"",username:"",password:""}),h=U({dbType:[{required:!0,message:"必填项不能为空",trigger:"blur"}],connName:[{required:!0,message:"必填项不能为空",trigger:"blur"}],connUrl:[{required:!0,message:"必填项不能为空",trigger:"blur"}],username:[{required:!0,message:"必填项不能为空",trigger:"blur"}],password:[{required:!0,message:"必填项不能为空",trigger:"blur"}]}),y=m=>{d.value=!0,r.id="",_.value&&_.value.resetFields(),m&&S(m)},S=m=>{j(m).then(l=>{Object.assign(r,l.data)})},w=()=>{_.value.validate(m=>{if(!m)return!1;K(r).then(()=>{d.value=!1,v("refreshPage"),V.success("操作成功")})})};return n({init:y}),(m,l)=>{const t=s("el-input"),p=s("el-form-item"),i=s("el-option"),c=s("el-select"),b=s("el-form"),g=s("el-button"),C=s("el-dialog");return L(),T(C,{modelValue:d.value,"onUpdate:modelValue":l[8]||(l[8]=o=>d.value=o),title:r.id?"修改":"新增","close-on-click-modal":!1},{footer:a(()=>[e(g,{onClick:l[6]||(l[6]=o=>d.value=!1)},{default:a(()=>[f("取消")]),_:1}),e(g,{type:"primary",onClick:l[7]||(l[7]=o=>w())},{default:a(()=>[f("确定")]),_:1})]),default:a(()=>[e(b,{ref_key:"dataFormRef",ref:_,model:r,rules:h,"label-width":"120px",onKeyup:l[5]||(l[5]=N(o=>w(),["enter"]))},{default:a(()=>[e(p,{label:"连接名",prop:"connName"},{default:a(()=>[e(t,{modelValue:r.connName,"onUpdate:modelValue":l[0]||(l[0]=o=>r.connName=o),placeholder:"连接名"},null,8,["modelValue"])]),_:1}),e(p,{label:"数据库类型",prop:"dbType"},{default:a(()=>[e(c,{modelValue:r.dbType,"onUpdate:modelValue":l[1]||(l[1]=o=>r.dbType=o),placeholder:"数据库类型",clearable:"",style:{width:"100%"}},{default:a(()=>[e(i,{value:"MySQL",label:"MySQL"}),e(i,{value:"PostgreSQL",label:"PostgreSQL"}),e(i,{value:"Oracle",label:"Oracle"}),e(i,{value:"SQLServer",label:"SQLServer"}),e(i,{value:"DM",label:"达梦8"}),e(i,{value:"Clickhouse",label:"Clickhouse"})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"数据库URL",prop:"connUrl"},{default:a(()=>[e(t,{modelValue:r.connUrl,"onUpdate:modelValue":l[2]||(l[2]=o=>r.connUrl=o),placeholder:"数据库URL"},null,8,["modelValue"])]),_:1}),e(p,{label:"用户名",prop:"username"},{default:a(()=>[e(t,{modelValue:r.username,"onUpdate:modelValue":l[3]||(l[3]=o=>r.username=o),placeholder:"用户名"},null,8,["modelValue"])]),_:1}),e(p,{label:"密码",prop:"password"},{default:a(()=>[e(t,{modelValue:r.password,"onUpdate:modelValue":l[4]||(l[4]=o=>r.password=o),type:"password",placeholder:"密码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Z=q({__name:"index",setup(Q){const n=U({queryForm:{connName:"",dbType:""},page:{current:1,pageSize:10,total:0,orderItems:[{column:"createTime",asc:!1}]},data:[],dataSelections:[],loading:!1}),v=k();M(()=>{d()});const d=(l=1,t)=>{n.page.current=l,t!==void 0&&(n.page.pageSize=t),n.loading=!0;const p={current:n.page.current,pageSize:n.page.pageSize,orderItems:n.page.orderItems,...n.queryForm};A(p).then(i=>{const{list:c,total:b}=i.data;n.data=c,n.page.total=b}),n.loading=!1},_=l=>{d(1,l)},r=l=>{d(l)},h=l=>{G(l).then(t=>{V.success(t.data)})},y=l=>{v.value.init(l)},S=l=>{let t=[];if(l)t=[l];else if(t=n.dataSelections?n.dataSelections:[],t.length===0){V.warning("请选择删除的记录");return}I.confirm("确定进行删除操作？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{H(t).then(()=>{V.success("删除成功"),d()})}).catch(p=>{console.error(p)})},w=l=>{n.dataSelections=l.map(t=>t.id)},m=l=>Array(l.length).fill("•").join("");return(l,t)=>{const p=s("el-input"),i=s("el-form-item"),c=s("el-option"),b=s("el-select"),g=s("el-button"),C=s("el-form"),o=s("el-table-column"),F=s("el-table"),$=s("el-pagination"),z=s("el-card"),B=O("loading");return L(),T(z,{shadow:"hover"},{default:a(()=>[e(C,{inline:!0,model:n.queryForm,onKeyup:t[5]||(t[5]=N(u=>d(),["enter"])),onSubmit:t[6]||(t[6]=P(()=>{},["prevent"]))},{default:a(()=>[e(i,null,{default:a(()=>[e(p,{modelValue:n.queryForm.connName,"onUpdate:modelValue":t[0]||(t[0]=u=>n.queryForm.connName=u),placeholder:"连接名"},null,8,["modelValue"])]),_:1}),e(i,{prop:"dbType"},{default:a(()=>[e(b,{modelValue:n.queryForm.dbType,"onUpdate:modelValue":t[1]||(t[1]=u=>n.queryForm.dbType=u),placeholder:"数据库类型",clearable:""},{default:a(()=>[e(c,{value:"MySQL",label:"MySQL"}),e(c,{value:"PostgreSQL",label:"PostgreSQL"}),e(c,{value:"Oracle",label:"Oracle"}),e(c,{value:"SQLServer",label:"SQLServer"}),e(c,{value:"DM",label:"达梦8"})]),_:1},8,["modelValue"])]),_:1}),e(i,null,{default:a(()=>[e(g,{onClick:t[2]||(t[2]=u=>d())},{default:a(()=>[f("查询")]),_:1}),e(g,{type:"primary",onClick:t[3]||(t[3]=u=>y())},{default:a(()=>[f("新增")]),_:1}),e(g,{type:"danger",onClick:t[4]||(t[4]=u=>S())},{default:a(()=>[f("删除")]),_:1})]),_:1})]),_:1},8,["model"]),D((L(),T(F,{data:n.data,border:!0,style:{width:"100%"},onSelectionChange:w},{default:a(()=>[e(o,{type:"selection","header-align":"center",align:"center",width:"50"}),e(o,{label:"连接名",prop:"connName","header-align":"center",align:"center"}),e(o,{label:"数据库类型",prop:"dbType","header-align":"center",align:"center"}),e(o,{label:"数据库URL",prop:"connUrl","show-overflow-tooltip":"","header-align":"center",align:"center"}),e(o,{label:"用户名",prop:"username","header-align":"center",align:"center"}),e(o,{label:"密码","header-align":"center",align:"center"},{default:a(u=>[R("span",null,E(m(u.row.password)),1)]),_:1}),e(o,{label:"操作",fixed:"right","header-align":"center",align:"center",width:"170"},{default:a(u=>[e(g,{type:"success",link:"",onClick:x=>h(u.row.id)},{default:a(()=>[f("测试")]),_:2},1032,["onClick"]),e(g,{type:"primary",link:"",onClick:x=>y(u.row.id)},{default:a(()=>[f("编辑")]),_:2},1032,["onClick"]),e(g,{type:"danger",link:"",onClick:x=>S(u.row.id)},{default:a(()=>[f("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[B,n.loading]]),e($,{"current-page":n.page.current,"page-size":n.page.pageSize,"page-sizes":[10,20,50,100,200],total:n.page.total,layout:"total,sizes,prev,pager,next,jumper",onSizeChange:_,onCurrentChange:r},null,8,["current-page","page-size","total"]),e(J,{ref_key:"addOrEditRef",ref:v,onRefreshPage:d},null,512)]),_:1})}}});export{Z as default};
